## Key Components of a Kubeconfig File

#### 1. Clusters:

- Contains information about Kubernetes clusters.
- Includes:
  - `server`: API server endpoint.
  - `certificate-authority`: Path to the CA certificate for secure communication.

#### 2. Users

- Details about users accessing the clusters.
- Includes:
  - `client-certificate`: Path to the user's certificate.
  - `client-key`: Path to the private key.

#### 3. Contexts:

- Links a cluster and a user.
- Defines:
  - Which cluster a user accesses.
  - An optional `namespace` for default namespace selection.

#### 4. Current Context:

- Specifies the default context to use when executing kubectl commands.

## Certificates in Kubeconfig

- Certificate Authority (CA):

  - Ensures secure communication by verifying server identity.
  - Can be referenced using:
    - certificate-authority (file path).
    - certificate-authority-data (base64 encoded CA content).

- User Certificates:
  - Client certificates (client-certificate) and keys (client-key) authenticate users.

## KubeConfig File

<img src="https://github.com/matoanbach/k8s-ckad/blob/main/assets/sec%201/15.png"/>

```yaml
apiVersion: v1
kind: Config

clusters:
  - name: my-kube-playground
    cluster:
      certificate-authority: ca.crt
      server: https://my-kube-playground:6443

contexts:
  - name: my-kube-admin@my-kube-playground
    context:
      cluster: my-kube-playground
      user: my-kube-admin

users:
  - name: my-kube-admin
    user:
      client-certificate: admin.crt
      client-key: admin.key
```

- keep adding other users as well:

```yaml
apiVersion: v1
kind: Config
current-context: dev-user@google

clusters:
  - name: my-kube-playground
  - name: developement
  - name: production
  - name: google
contexts:
  - name: my-kube-admin@my-kube-playground
  - name: dev-user@google
  - name: prod-user@production

users:
  - name: my-kube-admin
  - name: admin
  - name: dev-user
  - name: prod-user
```

#### Get the current context

```
kubectl config view
```

#### Update the current context

```
kubectl config use-context prod-user@production
```

### Certificates in KubeConfig

```yaml
apiVersion: v1
kind: Config
clusters:
  - name: production
    cluster:
      certificate-authority: /etc/kubernetes/pki/ca.crt # cross this out
      certificate-authority-data: ... # generated by running "cat ca.crt | base64" adn decoded by running "echo "..."" | base64 --decode"
```

- Change context file, run the command

```
kubectl config --kubeconfig=/root/my-kube-config use-context research
```

- To know the current context, run the command:

```
kubectl config --kubeconfig=/root/my-kube-config current-context
```

- set the kubeconfig file by changing env variables (no permenently saved)

```bash
export KUBECONFIG=/root/my-kube-config
source ~/.bashrc
kubectl config view
```

- set the kubeconfig file by changing env variables (permenently saved)

```bash
vim ~/.bashrc
# add -> export KUBECONFIG=/root/my-kube-config
```
